"use strict";require(["config.min"],function(){require(["jquery","header","aside"],function($,cookie){$(function(){function template(id,data){var str=$(id).text();str="print(`"+str+"`)",str=str.replace(/<%=(.+)%>/g,"`);print($1);print(`"),str=str.replace(/<%(.+)%>/g,"`);$1print(`"),console.log(data.length);var funstrr='\n\t\t\t\t(function(data){\n\t\t\t\t\tvar htmll="";\n\t\t\t\t\tfunction print(s){\n\t\t\t\t\t\thtmll+=s;\n\t\t\t\t\t}\n\t\t\t\t\t'+str+";\n\t\t\t\t\treturn htmll;\n\t\t\t\t})\n\t\t\t\t",realfun=eval(funstrr),res=realfun(data);return res}function co(){$("body").scrollTop()>=top?($(".comment .details_img .nav,.comment .guide").css({position:"fixed",top:0}),$(".comment .details_img .nav").css({left:left}),$(".comment .details_img").css({top:50,left:200})):($(".comment .details_img .nav,.comment .guide").css({position:"relative"}),$(".comment .details_img .nav").css({left:0}),$(".comment .details_img").css({top:0,left:0})),$("body").height()-$("body").scrollTop()<=1193?$(".comment .guide dl").fadeOut(200):$(".comment .guide dl").fadeIn(200)}function content_height(){for(var t,e=$(".content>div").length,i=0;i<e;i++)"block"==$(".content>div").eq(i).css("display")&&(t=$(".content>div").eq(i).height(),console.log(i,t));$(".content").height(t+50),$(".comment").height(t+100)}var order=cookie.get("order"),order_length;order_length=order&&"[]"!=order?JSON.parse(order).length:0,$(".header .ul_aboutme li .count").text(order_length),$(".aside .shopping .cart span").text(order_length);var index=location.href.indexOf("id="),id=location.href.substr(index+3);$.ajax({url:"../json/"+id+".json",timeout:1e4,error:function(){$(".big .loading").text("加载失败，请检查网络！"),$("title").text("欢迎来到音平商城")},success:function(t){setTimeout(function(){$(".big .loading").fadeOut(200).remove();for(var e=t.productPosition,i=t.productName,n=t.guarantee,o=t.productPrice,a=t.img_small,s=t.img_big,l=t.productID,r=t.details,g=0;g<e.length-1;g++){var c=$("<a href=''></a>");c.text(e[g]);var d=$("<span></span>");d.text(" ＞ "),$(".details .position").append(c),$(".details .position").append(d)}var u=$("<p></p>");u.text(e[e.length-1]),$(".details .position").append(u),$(".details .thing .name").text(i),$("title").text(i),$(".details .thing .guarantee").text(n),$(".details .price .money span i").text(o),$(".comment .nav .pri p span").text(o);for(g=0;g<a.length;g++){p=$("<li></li>");0==g&&p.addClass("active"),(m=$("<img src=''/>")).attr("src",a[g]),p.append(m),$(".magnifying .thumbnail .small").append(p)}for(g=0;g<s.length;g++){var p=$("<li></li>");0==g&&p.addClass("active");var m=$("<img src=''/>");m.attr("src",s[g]),p.append(m),$(".magnifying .big").append(p)}$(".magnifying .share p span").text(l);for(g=0;g<r.length;g++)(p=$("<li></li>")).text(r[g]),$(".comment .content .text ul").append(p);$(".buy").fadeIn(200)},2e3)}}),$.ajax({type:"get",url:"/api/advertising/getAdvertisingByCno?cno=170728",dataType:"jsonp",jsonp:"jsoncallback",timeout:1e4,error:function(){$(".promotion .loading").text("加载失败，请检查网络！")},success:function(t){setTimeout(function(){$(".promotion .loading").remove();for(var e=0;e<t.length;e++){var i=$("<li></li>"),n=$("<span></span>");n.text(t[e].name);var o=$("<a href='' target='_blank'></a>");o.attr("href",t[e].url),o.text(t[e].title),i.append(n).append(o),$(".thing .promotion ul").append(i)}},4e3)}}),$.ajax({type:"get",url:"/api/product/getDescription?id="+id,async:!0,timeout:1e4,error:function(){$(".photo .loading").text("加载失败，请检查网络！")},success:function(t){setTimeout(function(){$(".photo .loading").remove(),$(".content .photo .im").append(t.description),setTimeout(function(){content_height()},500)},4e3)}}),$.ajax({type:"get",url:"/api/product/getCommentCount?productId="+id,async:!0,success:function(t){var e;e=t.goodCount+t.badCount+t.midCount==0?1:parseInt(t.goodCount/(t.goodCount+t.badCount+t.midCount)*100);var i=parseInt(t.midCount/(t.goodCount+t.badCount+t.midCount)*100),n=parseInt(t.badCount/(t.goodCount+t.badCount+t.midCount)*100);$(".details .price .good span").text(e+"%"),$(".details .price .fr a:eq(0) span").text(t.goodCount),$(".details .price .fr a:eq(1) span").text(t.imgCount),$(".comment .nav ul li:eq(2) span").text("("+(t.goodCount+t.badCount+t.midCount)+")"),$(".pinglun .overall .totle p:eq(1) span").text(e),$(".pinglun .overall .totle p:eq(2) span").text(t.goodCount+t.badCount+t.midCount),$(".pinglun .overall .pro li:eq(0) p span").text("("+e+"%)"),$(".pinglun .overall .pro li:eq(0) .good").width(e),$(".pinglun .overall .pro li:eq(0) .bad").width(100-e),$(".pinglun .overall .pro li:eq(1) p span").text("("+(100-e-n)+"%)"),$(".pinglun .overall .pro li:eq(1) .good").width(i),$(".pinglun .overall .pro li:eq(1) .bad").width(100-i),$(".pinglun .overall .pro li:eq(2) p span").text("("+n+"%)"),$(".pinglun .overall .pro li:eq(2) .good").width(n),$(".pinglun .overall .pro li:eq(2) .bad").width(100-n)}}),$.ajax({type:"get",url:"/api/product/proConsult?dataType=json&offset0=&max=0&sort=createDate&order=desc&id="+id,async:!0,success:function(t){$(".comment .nav ul li:eq(3) span").text("("+t.count+")")}}),$(".magnifying .thumbnail ul").on("mouseenter","li",function(){$(this).addClass("active").siblings().removeClass("active"),$(this).parents(".thumbnail").siblings(".big").find("li").eq($(this).index()).stop().animate({opacity:1}).siblings("li").stop().animate({opacity:0})}),$(".magnifying .thumbnail .fl,.magnifying .thumbnail .fr").on("click",function(t){var e=$(this).siblings("ul").find("li[class=active]").index(),i=$(this).siblings("ul").find("li").length;e="fl"==t.target.className?0==e?i-1:--e:e==i-1?0:++e,$(this).siblings("ul").find("li").eq(e).addClass("active").siblings().removeClass("active"),$(this).parent().siblings(".big").find("li").eq(e).animate({opacity:1}).siblings().animate({opacity:0})});var t=$(".magnifying .big").offset().top,l=$(".magnifying .big").offset().left,w=$(".magnifying .big").width(),h=$(".magnifying .big").height(),multiple=3;$(".magnifying .bg").css("width",w/multiple),$(".magnifying .bg").css("height",h/multiple),$(".magnifying .big").on("mousemove",function(e,i){var n={x:e.pageX||i.x,y:e.pageY||i.y},o={top:Math.min(h-$(".magnifying .bg").height()+1,Math.max(0,n.y-t-$(".magnifying .bg").height()/2)),left:Math.min(w-$(".magnifying .bg").width()+2,Math.max(0,n.x-l-$(".magnifying .bg").width()/2))},a=$(".magnifying .small li[class='active']").index(),s=$(".magnifying .big img").eq(a).attr("src");$(".magnifying .bg").css("top",o.top).css("left",o.left).show(200),$(".magnifying .bigbig").css("background-image","url("+s+")").css("background-size",multiple*w+"px "+multiple*h+"px").css("background-position",-o.left*multiple+"px "+-o.top*multiple+"px").show(200)}),$(".magnifying .bg").on("mousewheel DOMMouseScroll",function(t){t.preventDefault(),(t.originalEvent.wheelDelta<0?1:t.originalEvent.detail>0?1:0)?(multiple=multiple>=4?4:multiple+.1,$(".magnifying .bg").css("width",w/multiple),$(".magnifying .bg").css("height",h/multiple),$(".magnifying .big").trigger("mousemove",{x:t.pageX,y:t.pageY})):(multiple=multiple<=1?1:multiple-.1,$(".magnifying .bg").css("width",w/multiple),$(".magnifying .bg").css("height",h/multiple),$(".magnifying .big").trigger("mousemove",{x:t.pageX,y:t.pageY}))}),$(".magnifying .big").on("mouseleave",function(){$(".magnifying .bg").hide(200),$(".magnifying .bigbig").hide(200)}),$(".thing .buy .plus span").on("click",function(){var t=parseInt($(this).parent().prev().html());$(this).index()?t=1==t?1:t-1:t+=1,$(this).parent().prev().html(t)});var top=$(".comment .details_img .nav").offset().top,left=$(".comment .details_img .nav").offset().left;co(),$(window).on("scroll",function(){co()});var offset=0,offset2=0;$(".comment .nav ul li").on("click",function(){setTimeout(function(){content_height()},300),setTimeout(function(){co()},1400),2==$(this).index()&&($(".zixun .dl .loading").html('<img src="../img/loading.gif" />  loading……'),$.ajax({type:"get",url:"/api/product/proComment?dataType=json&offset="+offset+"&max=15&sort=createDate&order=desc&id="+id+"&type=1",async:!0,timeout:1e4,error:function(){$(".pinglun .dl .loading").text("加载失败，请检查网络！")},success:function(t){setTimeout(function(){t.commentList.length<15&&$(".pinglun .more").text("已加载全部"),offset+=15,$(".pinglun .dl .loading").remove(),$(".pinglun .dl").append(template("#tem",t.commentList)),content_height(),$(".pinglun .more").fadeIn(200)},3e3)}})),3==$(this).index()&&($(".zixun .dl .loading").html('<img src="../img/loading.gif" />  loading……'),$.ajax({type:"get",url:"/api/product/proConsult?dataType=json&offset="+offset2+"&max=15&sort=createDate&order=desc&id="+id,async:!0,timeout:1e4,error:function(){$(".zixun .dl .loading").text("加载失败，请检查网络！")},success:function(t){setTimeout(function(){t.consultList.length<15&&$(".zixun .more").text("已加载全部"),offset2+=15,$(".zixun .dl .loading").remove(),$(".zixun .dl").append(template("#question",t.consultList)),content_height(),$(".zixun .more").fadeIn(200)},3e3)}})),$(this).addClass("active").siblings().removeClass("active"),$(".comment .content").children().eq($(this).index()).fadeIn(200).siblings().fadeOut(200)}),$(".pinglun .more").on("click",function(){"已加载全部"!=$(this).text()&&($(this).html("<img src='../img/loading.gif' />  loading……"),$.ajax({type:"get",url:"/api/product/proComment?dataType=json&offset="+offset+"&max=15&sort=createDate&order=desc&id="+id+"&type=1",async:!0,timeout:1e4,error:function(){$(".pinglun .dl .more").text("加载失败，点击刷新！")},success:function(t){setTimeout(function(){t.commentList.length<15?$(".pinglun .more").text("已加载全部"):$(".pinglun .more").text("点击加载更多"),offset+=15,$(".pinglun .dl .loading").remove(),$(".pinglun .dl").append(template("#tem",t.commentList)),content_height(),$(".pinglun .more").fadeIn(200)},1e3)}}))}),$(".zixun .more").on("click",function(){"已加载全部"!=$(this).text()&&($(this).html("<img src='../img/loading.gif' />  loading……"),$.ajax({type:"get",url:"/api/product/proConsult?dataType=json&offset="+offset2+"&max=15&sort=createDate&order=desc&id="+id,async:!0,timeout:1e4,error:function(){$(".zixun .dl .more").text("加载失败，点击刷新！")},success:function(t){setTimeout(function(){t.consultList.length<15?$(".zixun .more").text("已加载全部"):$(".zixun .more").text("点击加载更多"),offset2+=15,$(".zixun .dl .loading").remove(),$(".zixun .dl").append(template("#question",t.consultList)),content_height(),$(".zixun .more").fadeIn(200)},1e3)}}))}),$(".tocart").on("click",function(t){var e=$(".details .magnifying .big li img:eq(0)").attr("src"),i=$(".details .thing .name").text(),n=$(".details .thing .price .money i").text(),o=$(".details .thing .buy .count .num").text(),a=$(".details .thing .guarantee").text(),s=[e,i,a,n,o,id];if(cookie.get("order")){var l=JSON.parse(cookie.get("order")),r=!1,g=0;l.forEach(function(t,e){t[1]==i&&(r=!0,g=e)}),r?l[g][4]=parseInt(l[g][4])+parseInt(o):l.push(s),cookie.set("order",JSON.stringify(l))}else cookie.set("order",JSON.stringify([s]));var c={x:t.clientX,y:t.clientY},d=$("<img src=''/>");d.attr("src",e).width(30).height(30).css({"border-radius":"50%",position:"fixed",top:c.y-15,left:c.x-15,"z-index":2e3}),$("body").append(d);var u=$(".aside .shopping .cart").offset().top-$("body").scrollTop()+10,p=$(".aside .shopping .cart").offset().left;$(".add_success").css("top",u-10);var m=(u-c.y-.001*(p-c.x)*(p-c.x))/(p-c.x),f=0,h=setInterval(function(){d.css("left",f+c.x).css("top",.001*f*f+m*f+c.y),(f+=5)+c.x>=p+3&&(clearInterval(h),d.fadeOut(800,function(){d.remove(),r||($(".header .ul_aboutme li .count").text(+$(".header .ul_aboutme li .count").text()+ +o),$(".aside .shopping .cart span").text(+$(".aside .shopping .cart span").text()+ +o)),$(".add_success").css("right","30px"),setTimeout(function(){$(".add_success").css("right","-370px")},4e3)}))},15)}),$(".add_success>span").on("click",function(){$(".add_success").css("right","-370px")}),$(".footer_con").load("../html/footer.html").css("margin-top",50)})})});